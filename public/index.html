<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Spotify Song Insights</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
    h1 { margin-bottom: 40px; }
    canvas { margin: 20px auto; display: block; max-width: 90%; }
  </style>
</head>
<body>
  <h1>Spotify Song Insights</h1>

  <canvas id="energyChart"></canvas>
  <canvas id="danceChart"></canvas>
  <canvas id="tempoChart"></canvas>

  <script>
    const API_URL = 'https://spotify-api-wa8h.onrender.com'; // Your deployed Render API

    async function fetchTracks() {
      const res = await fetch(`${API_URL}/artists`);
      const data = await res.json();
      return data;
    }

    function getTopN(tracks, key, n = 20) {
      return tracks
        .sort((a, b) => b[key] - a[key])
        .slice(0, n);
    }

    async function drawCharts() {
      const tracks = await fetchTracks();

      // Top 20 tracks by energy
      const topEnergy = getTopN(tracks, 'energy');
      const topDance = getTopN(tracks, 'danceability');
      const topTempo = getTopN(tracks, 'tempo');

      // Energy Chart
      new Chart(document.getElementById('energyChart').getContext('2d'), {
        type: 'bar',
        data: {
          labels: topEnergy.map(t => t.track_name),
          datasets: [{
            label: 'Energy',
            data: topEnergy.map(t => t.energy),
            backgroundColor: 'rgba(255, 99, 132, 0.6)'
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } },
          scales: { x: { ticks: { maxRotation: 90, minRotation: 45 } } }
        }
      });

      // Danceability Chart
      new Chart(document.getElementById('danceChart').getContext('2d'), {
        type: 'bar',
        data: {
          labels: topDance.map(t => t.track_name),
          datasets: [{
            label: 'Danceability',
            data: topDance.map(t => t.danceability),
            backgroundColor: 'rgba(54, 162, 235, 0.6)'
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } },
          scales: { x: { ticks: { maxRotation: 90, minRotation: 45 } } }
        }
      });

      // Tempo Chart
      new Chart(document.getElementById('tempoChart').getContext('2d'), {
        type: 'bar',
        data: {
          labels: topTempo.map(t => t.track_name),
          datasets: [{
            label: 'Tempo (BPM)',
            data: topTempo.map(t => t.tempo),
            backgroundColor: 'rgba(255, 206, 86, 0.6)'
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } },
          scales: { x: { ticks: { maxRotation: 90, minRotation: 45 } } }
        }
      });
    }

    drawCharts();
  </script>
</body>
</html>
